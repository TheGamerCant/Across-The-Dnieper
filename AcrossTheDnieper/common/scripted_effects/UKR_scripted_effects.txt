make_borders_look_nice={
	set_variable = { global.donbass_countries_states_owned = 0 }
	every_state={
		limit={
			CONTROLLER={
				OR={
					tag = DON
					tag = LHK
				}
			}
		}
		
		add_to_variable = { global.donbass_countries_states_owned = 1 }
	}
	
	if={
		limit = { has_global_flag = donetsk_has_capitulated }
		every_state={
			limit = { has_state_flag = luhansk_oblast_flag }
			UKR = { transfer_state = PREV }
		}
		
		if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 1 compare = equals }
				LHK = { transfer_state = 159 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 2 compare = equals }
				LHK = { transfer_state = 159 transfer_state = 152 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 3 compare = equals }
				LHK = { transfer_state = 159 transfer_state = 152 transfer_state = 174 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 4 compare = equals }
				LHK = { transfer_state = 159 transfer_state = 152 transfer_state = 174 transfer_state = 155 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 5 compare = equals }
				LHK = { transfer_state = 159 transfer_state = 152 transfer_state = 174 transfer_state = 155 transfer_state = 154 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 6 compare = equals }
				LHK = { transfer_state = 159 transfer_state = 152 transfer_state = 174 transfer_state = 155 transfer_state = 154 transfer_state = 136 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 7 compare = equals }
				LHK = { transfer_state = 159 transfer_state = 152 transfer_state = 174 transfer_state = 155 transfer_state = 154 transfer_state = 136 transfer_state = 131 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 8 compare = equals }
				LHK = { transfer_state = 159 transfer_state = 152 transfer_state = 174 transfer_state = 155 transfer_state = 154 transfer_state = 136 transfer_state = 131 transfer_state = 109 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 9 compare = greater_than_or_equals }
				LHK = { transfer_state = 159 transfer_state = 152 transfer_state = 174 transfer_state = 155 transfer_state = 154 transfer_state = 136 transfer_state = 131 transfer_state = 109 transfer_state = 103 }
			}
		}
	}
	else_if={
		limit = { has_global_flag = donetsk_has_capitulated }
		every_state={
			limit = { has_state_flag = donetsk_oblast_flag }
			UKR = { transfer_state = PREV }
		}
		
		if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 1 compare = equals }
				DON = { transfer_state = 208 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 2 compare = equals }
				DON = { transfer_state = 208 transfer_state = 186 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 3 compare = equals }
				DON = { transfer_state = 208 transfer_state = 186 transfer_state = 173 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 4 compare = equals }
				DON = { transfer_state = 208 transfer_state = 186 transfer_state = 173 transfer_state = 230 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 5 compare = equals }
				DON = { transfer_state = 208 transfer_state = 186 transfer_state = 173 transfer_state = 230 transfer_state = 195 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 6 compare = equals }
				DON = { transfer_state = 208 transfer_state = 186 transfer_state = 173 transfer_state = 230 transfer_state = 195 transfer_state = 166 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 7 compare = equals }
				DON = { transfer_state = 208 transfer_state = 186 transfer_state = 173 transfer_state = 230 transfer_state = 195 transfer_state = 166 transfer_state = 146 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 8 compare = greater_than_or_equals }
				DON = { transfer_state = 208 transfer_state = 186 transfer_state = 173 transfer_state = 230 transfer_state = 195 transfer_state = 166 transfer_state = 146 transfer_state = 135 }
			}
		}
	}
	else={
		every_state={
			limit = { OR={ has_state_flag = donetsk_oblast_flag has_state_flag = luhansk_oblast_flag } }
			UKR = { transfer_state = PREV }
		}
		
		if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 3 compare = equals }
				LHK = { transfer_state = 174 }
				DON = { transfer_state = 186 transfer_state = 173 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 4 compare = equals }
				LHK = { transfer_state = 174 transfer_state = 159 }
				DON = { transfer_state = 186 transfer_state = 173 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 5 compare = equals }
				LHK = { transfer_state = 174 transfer_state = 159 transfer_state = 152 }
				DON = { transfer_state = 186 transfer_state = 173 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 6 compare = equals }
				LHK = { transfer_state = 174 transfer_state = 159 transfer_state = 152 }
				DON = { transfer_state = 186 transfer_state = 173 transfer_state = 208 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 7 compare = equals }
				LHK = { transfer_state = 174 transfer_state = 159 transfer_state = 152 transfer_state = 155 }
				DON = { transfer_state = 186 transfer_state = 173 transfer_state = 208 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 8 compare = equals }
				LHK = { transfer_state = 174 transfer_state = 159 transfer_state = 152 transfer_state = 155 transfer_state = 154 }
				DON = { transfer_state = 186 transfer_state = 173 transfer_state = 208 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 9 compare = equals }
				LHK = { transfer_state = 174 transfer_state = 159 transfer_state = 152 transfer_state = 155 transfer_state = 154 transfer_state = 136 }
				DON = { transfer_state = 186 transfer_state = 173 transfer_state = 208 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 10 compare = equals }
				LHK = { transfer_state = 174 transfer_state = 159 transfer_state = 152 transfer_state = 155 transfer_state = 154 transfer_state = 136 }
				DON = { transfer_state = 186 transfer_state = 173 transfer_state = 208 transfer_state = 230 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 11 compare = equals }
				LHK = { transfer_state = 174 transfer_state = 159 transfer_state = 152 transfer_state = 155 transfer_state = 154 transfer_state = 136 }
				DON = { transfer_state = 186 transfer_state = 173 transfer_state = 208 transfer_state = 230 transfer_state = 195 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 12 compare = equals }
				LHK = { transfer_state = 174 transfer_state = 159 transfer_state = 152 transfer_state = 155 transfer_state = 154 transfer_state = 136 }
				DON = { transfer_state = 186 transfer_state = 173 transfer_state = 208 transfer_state = 230 transfer_state = 195 transfer_state = 166 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 13 compare = equals }
				LHK = { transfer_state = 174 transfer_state = 159 transfer_state = 152 transfer_state = 155 transfer_state = 154 transfer_state = 136 transfer_state = 109 }
				DON = { transfer_state = 186 transfer_state = 173 transfer_state = 208 transfer_state = 230 transfer_state = 195 transfer_state = 166 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 14 compare = equals }
				LHK = { transfer_state = 174 transfer_state = 159 transfer_state = 152 transfer_state = 155 transfer_state = 154 transfer_state = 136 transfer_state = 109 transfer_state = 131 }
				DON = { transfer_state = 186 transfer_state = 173 transfer_state = 208 transfer_state = 230 transfer_state = 195 transfer_state = 166 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 15 compare = equals }
				LHK = { transfer_state = 174 transfer_state = 159 transfer_state = 152 transfer_state = 155 transfer_state = 154 transfer_state = 136 transfer_state = 109 transfer_state = 131 }
				DON = { transfer_state = 186 transfer_state = 173 transfer_state = 208 transfer_state = 230 transfer_state = 195 transfer_state = 166 transfer_state = 146 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 16 compare = equals }
				LHK = { transfer_state = 174 transfer_state = 159 transfer_state = 152 transfer_state = 155 transfer_state = 154 transfer_state = 136 transfer_state = 109 transfer_state = 131 }
				DON = { transfer_state = 186 transfer_state = 173 transfer_state = 208 transfer_state = 230 transfer_state = 195 transfer_state = 166 transfer_state = 146 transfer_state = 135 }
			}
		}
		else_if={
			limit = {
				check_variable = { var = global.donbass_countries_states_owned value = 17 compare = greater_than_or_equals }
				LHK = { transfer_state = 174 transfer_state = 159 transfer_state = 152 transfer_state = 155 transfer_state = 154 transfer_state = 136 transfer_state = 109 transfer_state = 131 transfer_state = 103 }
				DON = { transfer_state = 186 transfer_state = 173 transfer_state = 208 transfer_state = 230 transfer_state = 195 transfer_state = 166 transfer_state = 146 transfer_state = 135 }
			}
		}
	}
	

	
	
	#Keep this at the bottom
	if={
		limit = { has_global_flag = donetsk_has_capitulated }
		UKR = { annex_country = { target = DON transfer_troops = no } }
	}
	
	if={
		limit = { has_global_flag = luhansk_has_capitulated }
		UKR = { annex_country = { target = LHK transfer_troops = no } }
	}
	
	if={
		limit = { has_global_flag = kharkiv_has_capitulated }
		UKR = { annex_country = { target = KHK transfer_troops = no } }
	}
	
	if={
		limit = { has_global_flag = odesa_has_capitulated }
		UKR = { annex_country = { target = ODS transfer_troops = no } }
	}
	
	if={
		limit = { has_global_flag = novorossiya_has_capitulated }
		UKR = { annex_country = { target = NOV transfer_troops = no } }
	}
	clear_variable = global.donbass_countries_states_owned
}

load_russian_occupation={
	hidden_effect={
		UGE = {
			original_tag = UKR
			every_state={
				limit = {
					OR={
						has_state_flag = akarpatskia_oblast_flag
						has_state_flag = cherkasy_oblast_flag
						has_state_flag = chernihiv_oblast_flag
						has_state_flag = chernivtsi_oblast_flag
						has_state_flag = crimea_oblast_flag
						has_state_flag = dnipro_oblast_flag
						has_state_flag = donetsk_oblast_flag
						has_state_flag = ivano_frankivsk_oblast_flag
						has_state_flag = kharkiv_oblast_flag
						has_state_flag = kherson_oblast_flag
						has_state_flag = khmelnytskyi_oblast_flag
						has_state_flag = kirovohrad_oblast_flag
						has_state_flag = kyiv_oblast_flag
						has_state_flag = luhansk_oblast_flag
						has_state_flag = lviv_oblast_flag
						has_state_flag = mykolaiv_oblast_flag
						has_state_flag = odessa_oblast_flag
						has_state_flag = poltava_oblast_flag
						has_state_flag = rivne_oblast_flag
						has_state_flag = sumy_oblast_flag
						has_state_flag = ternopil_oblast_flag
						has_state_flag = vinnytsia_oblast_flag
						has_state_flag = volyn_oblast_flag
						has_state_flag = zaporizhia_oblast_flag
						has_state_flag = zhytomyr_oblast_flag
					}
				}
				add_core_of = PREV
			}
		}
		country_lock_all_division_template = no
	
		remove_dynamic_modifier = { modifier = UKR_armed_forces_of_ukraine_soviet_doctrine }
		remove_dynamic_modifier = { modifier = UKR_armed_forces_of_ukraine_reforming }
		remove_dynamic_modifier = { modifier = UKR_armed_forces_of_ukraine_western_doctrine }
		remove_dynamic_modifier = { modifier = UKR_air_force_of_ukraine }
		remove_dynamic_modifier = { modifier = UKR_air_force_of_ukraine_reforming }
		remove_dynamic_modifier = { modifier = UKR_navy_of_ukraine }
		remove_dynamic_modifier = { modifier = UKR_sotn_oligarchs }
		remove_dynamic_modifier = { modifier = UKR_sotn_nationalists }
		remove_dynamic_modifier = { modifier = UKR_sotn_pro_russians }
		remove_dynamic_modifier = { modifier = UKR_sotn_liberals }
		
		set_cosmetic_tag = UKR_russian_puppet
		set_global_flag = ukraine_rada_disbanded
		
		add_ideas = {
			ROU_unstable_government
			
			oligarchy
			martial_law
			limited_conscription
			
			state_controlled_press
			bipolarist
			unions_restricted
			womens_rights_traditional_values
			lgbtq_rights_behind_closed_doors
			minority_rights_minor_inequality
			nationalism_laws_pacifist
			firearm_laws_restricted
			alchohol_narcotics_laws_largely_regulated
			religion_law_religious
		}
		
		remove_ideas = UKR_valerii_zaluzhnui
		remove_ideas = UKR_oleksandr_syrskyi
		remove_ideas = UKR_serhiy_popko
		remove_ideas = UKR_mykhailo_zabrodskyi
		remove_ideas = UKR_serhiy_drozdov
		remove_ideas = UKR_serhiy_hayduk
		
		if={
			limit = {
				has_game_rule = {
					rule = UKR_ai_war_behavior
					option = DISHONOUR_BEFORE_DEATH_QUICK_COLLAPSE
				}
			}
			add_ideas = UKR_collapse_quickly
		}
		
		if={
			limit= { NOT = { has_completed_focus = UKR_dishonour_before_death } }
			complete_national_focus = UKR_dishonour_before_death
		}
	}
}

remove_cores={
	hidden_effect={
		random_country={
			limit = { has_cosmetic_tag = UKR_russian_puppet }
			set_variable = { global.russian_occupied_ukraine_tag = THIS }
			every_state={
				limit={ 
					NOT = { state = 92 } 
					OR={
						has_state_flag = akarpatskia_oblast_flag
						has_state_flag = cherkasy_oblast_flag
						has_state_flag = chernihiv_oblast_flag
						has_state_flag = chernivtsi_oblast_flag
						has_state_flag = crimea_oblast_flag
						has_state_flag = dnipro_oblast_flag
						has_state_flag = donetsk_oblast_flag
						has_state_flag = ivano_frankivsk_oblast_flag
						has_state_flag = kharkiv_oblast_flag
						has_state_flag = kherson_oblast_flag
						has_state_flag = khmelnytskyi_oblast_flag
						has_state_flag = kirovohrad_oblast_flag
						has_state_flag = kyiv_oblast_flag
						has_state_flag = luhansk_oblast_flag
						has_state_flag = lviv_oblast_flag
						has_state_flag = mykolaiv_oblast_flag
						has_state_flag = odessa_oblast_flag
						has_state_flag = poltava_oblast_flag
						has_state_flag = rivne_oblast_flag
						has_state_flag = sumy_oblast_flag
						has_state_flag = ternopil_oblast_flag
						has_state_flag = vinnytsia_oblast_flag
						has_state_flag = volyn_oblast_flag
						has_state_flag = zaporizhia_oblast_flag
						has_state_flag = zhytomyr_oblast_flag
					}
				}
				remove_core_of = PREV
				add_claim_by = PREV
				
				force_enable_resistance = { 
					clear = no
					occupier = var:global.russian_occupied_ukraine_tag
					occupied = UGE
				}
				start_resistance = UGE
				
				
				set_variable_to_random = {
					var = resistance_to_add
					min = 35
					max = 50
					integer = yes
				}
				set_variable_to_random = {
					var = compliance_to_add
					min = 0
					max = 5
					integer = yes
				}
				
				set_resistance = var:resistance_to_add
				set_compliance = var:compliance_to_add
				
				clear_variable = resistance_to_add
				clear_variable = compliance_to_add
			}
			country_lock_all_division_template = no
			clear_variable = global.russian_occupied_ukraine_tag 
		}
	}
}

russia_ukraine_peace={		#This is total Ukrainian victory
	SOV = { white_peace = UKR news_event = { id = atd_news.54 days = 2 } }
	clear_russia_ukraine_war_state_modifiers = yes
	clr_global_flag = russia_ukraine_war
	clr_global_flag = a_harsh_war_active_flag
	every_state={
		limit={
			OWNER={
				OR={
					tag = SOV
					is_in_faction_with = SOV
					is_puppet_of = SOV
				}
			}
			OR={
				has_state_flag = akarpatskia_oblast_flag
				has_state_flag = cherkasy_oblast_flag
				has_state_flag = chernihiv_oblast_flag
				has_state_flag = chernivtsi_oblast_flag
				has_state_flag = crimea_oblast_flag
				has_state_flag = dnipro_oblast_flag
				has_state_flag = donetsk_oblast_flag
				has_state_flag = ivano_frankivsk_oblast_flag
				has_state_flag = kharkiv_oblast_flag
				has_state_flag = kherson_oblast_flag
				has_state_flag = khmelnytskyi_oblast_flag
				has_state_flag = kirovohrad_oblast_flag
				has_state_flag = kyiv_oblast_flag
				has_state_flag = luhansk_oblast_flag
				has_state_flag = lviv_oblast_flag
				has_state_flag = mykolaiv_oblast_flag
				has_state_flag = odessa_oblast_flag
				has_state_flag = poltava_oblast_flag
				has_state_flag = rivne_oblast_flag
				has_state_flag = sumy_oblast_flag
				has_state_flag = ternopil_oblast_flag
				has_state_flag = vinnytsia_oblast_flag
				has_state_flag = volyn_oblast_flag
				has_state_flag = zaporizhia_oblast_flag
				has_state_flag = zhytomyr_oblast_flag
			}
		}
		UKR = { transfer_state = PREV }
	}
	country_event = { id = super.2 }
}